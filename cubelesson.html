<!DOCTYPE html>  
<html lang="zh-CN">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>ç«‹æ–¹ä½“å…¨èƒ½æ•™å­¦ - ä½“ç§¯ä¸å±•å¼€å›¾</title>  
    <style>  
        body { margin: 0; overflow: hidden; font-family: 'Comic Sans MS', 'YouYuan', 'Microsoft YaHei', sans-serif; background-color: #E0F7FA; }  
          
        /* ä¾§è¾¹æ§åˆ¶æ  */  
        #sidebar {  
            position: absolute;  
            top: 0;  
            left: 0;  
            width: 340px;  
            height: 100vh;  
            background: rgba(255, 255, 255, 0.96);  
            box-shadow: 2px 0 15px rgba(0,0,0,0.1);  
            padding: 20px;  
            box-sizing: border-box;  
            overflow-y: auto;  
            display: flex;  
            flex-direction: column;  
            gap: 15px;  
            z-index: 10;  
        }  
  
        h1 { color: #FF6B6B; text-align: center; font-size: 22px; margin-top: 0; margin-bottom: 10px;}  
          
        /* æ¨¡å¼åˆ‡æ¢ */  
        .mode-switch {  
            display: flex;  
            background: #ECEFF1;  
            border-radius: 20px;  
            padding: 5px;  
            margin-bottom: 10px;  
        }  
        .mode-btn {  
            flex: 1;  
            border: none;  
            background: transparent;  
            padding: 10px;  
            border-radius: 15px;  
            cursor: pointer;  
            font-weight: bold;  
            color: #78909C;  
            transition: 0.3s;  
        }  
        .mode-btn.active {  
            background: white;  
            color: #0097A7;  
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);  
        }  
  
        /* é€šç”¨é¢æ¿ */  
        .panel {  
            background: #fff;  
            border: 2px solid #B2EBF2;  
            border-radius: 15px;  
            padding: 15px;  
            display: none; /* é»˜è®¤éšè—ï¼Œé€šè¿‡JSæ§åˆ¶æ˜¾ç¤º */  
        }  
        .panel.show { display: block; }  
  
        /* æ§ä»¶æ ·å¼ */  
        .slider-group { display: flex; align-items: center; margin-bottom: 10px; }  
        .slider-group label { width: 45px; font-weight: bold; color: #555; font-size: 14px;}  
        input[type=range] { flex: 1; margin: 0 10px; cursor: pointer; }  
          
        /* æŒ‰é’®ç½‘æ ¼ */  
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }  
        button.action-btn {  
            padding: 8px; border: none; border-radius: 8px;  
            cursor: pointer; font-size: 14px; font-weight: bold; color: white;  
            transition: transform 0.1s;  
        }  
        button.action-btn:active { transform: scale(0.95); }  
        .btn-vertex { background: #2196F3; }  
        .btn-edge { background: #4CAF50; }  
        .btn-face { background: #FF9800; }  
        .btn-reset { background: #9E9E9E; grid-column: span 2; }  
  
        /* å±•å¼€å›¾é€‰æ‹©å™¨ */  
        select {  
            width: 100%; padding: 10px; border-radius: 8px;  
            border: 2px solid #B2EBF2; font-size: 14px; margin-bottom: 15px;  
            outline: none; cursor: pointer;  
        }  
  
        /* æ•™å­¦ä¿¡æ¯ */  
        #info-box {  
            background: #FFF3E0; border: 2px dashed #FFB74D;  
            padding: 12px; border-radius: 10px; font-size: 15px; line-height: 1.4;  
        }  
        .highlight { color: #D84315; font-weight: bold; }  
  
    </style>  
    <script type="importmap">  
        {  
            "imports": {  
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",  
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"  
            }  
        }  
    </script>  
</head>  
<body>  
  
    <div id="sidebar">  
        <h1>ğŸ§Š å‡ ä½•å®éªŒå®¤</h1>  
          
        <div class="mode-switch">  
            <button class="mode-btn active" id="modeVolume">ğŸ“¦ ç§¯æœ¨ä½“ç§¯</button>  
            <button class="mode-btn" id="modeNet">ğŸ“„ å±•å¼€æŠ˜å </button>  
        </div>  
  
        <!-- æ¨¡å¼1ï¼šä½“ç§¯ä¸ç»“æ„ -->  
        <div id="panelVolume" class="panel show">  
            <p style="margin-top:0; font-weight:bold; color:#666;">1. æ”¹å˜é•¿å®½é«˜</p>  
            <div class="slider-group">  
                <label>é•¿:</label> <input type="range" id="rangeL" min="1" max="5" value="3"> <span id="valL">3</span>  
            </div>  
            <div class="slider-group">  
                <label>å®½:</label> <input type="range" id="rangeW" min="1" max="5" value="2"> <span id="valW">2</span>  
            </div>  
            <div class="slider-group">  
                <label>é«˜:</label> <input type="range" id="rangeH" min="1" max="5" value="3"> <span id="valH">3</span>  
            </div>  
  
            <p style="margin-top:10px; font-weight:bold; color:#666;">2. è®¤è¯†ç»“æ„</p>  
            <div class="btn-grid">  
                <button class="action-btn btn-vertex" id="btnVertex">ğŸ”µ é¡¶ç‚¹ (8)</button>  
                <button class="action-btn btn-edge" id="btnEdge">ğŸŸ¢ æ£± (12)</button>  
                <button class="action-btn btn-face" id="btnFace">ğŸŸ  é¢ (6)</button>  
                <button class="action-btn btn-reset" id="btnReset">ğŸ‘ï¸ è¿˜åŸç§¯æœ¨</button>  
            </div>  
        </div>  
  
        <!-- æ¨¡å¼2ï¼šå±•å¼€å›¾ -->  
        <div id="panelNet" class="panel">  
            <p style="margin-top:0; font-weight:bold; color:#666;">1. é€‰æ‹©å±•å¼€å½¢çŠ¶ (å…±11ç§)</p>  
            <select id="netSelector">  
                <optgroup label="1-4-1 å‹ (ä¸­é—´4ä¸ª)">  
                    <option value="0">ç±»å‹ 1 (æœ€å¸¸è§)</option>  
                    <option value="1">ç±»å‹ 2</option>  
                    <option value="2">ç±»å‹ 3</option>  
                    <option value="3">ç±»å‹ 4</option>  
                    <option value="4">ç±»å‹ 5</option>  
                    <option value="5">ç±»å‹ 6</option>  
                </optgroup>  
                <optgroup label="2-3-1 å‹ (ä¸­é—´3ä¸ª)">  
                    <option value="6">ç±»å‹ 7 (å°æ¥¼æ¢¯)</option>  
                    <option value="7">ç±»å‹ 8</option>  
                    <option value="8">ç±»å‹ 9</option>  
                </optgroup>  
                <optgroup label="2-2-2 å‹ (æ¥¼æ¢¯)">  
                    <option value="9">ç±»å‹ 10 (å¤§æ¥¼æ¢¯)</option>  
                </optgroup>  
                <optgroup label="3-3 å‹ (ä¸¤æ’)">  
                    <option value="10">ç±»å‹ 11</option>  
                </optgroup>  
            </select>  
  
            <p style="margin-top:10px; font-weight:bold; color:#666;">2. åŠ¨æ‰‹æŠ˜å </p>  
            <div class="slider-group">  
                <label>æŠ˜å :</label>  
                <input type="range" id="rangeFold" min="0" max="100" value="0">  
            </div>  
            <p style="font-size:12px; color:#888; text-align:center;">æ‹–åŠ¨æ»‘å—æŠŠçº¸ç‰‡æŠ˜èµ·æ¥ï¼</p>  
        </div>  
  
        <!-- åŠ¨æ€ä¿¡æ¯ -->  
        <div id="info-box">  
            ğŸ‘‹ æ¬¢è¿ï¼<br>åœ¨è¿™é‡Œå¯ä»¥å­¦ä¹ ä½“ç§¯è®¡ç®—ï¼Œè¿˜å¯ä»¥ç©â€œæŠ˜çº¸â€æ¸¸æˆå“¦ã€‚  
        </div>  
    </div>  
  
    <script type="module">  
        import * as THREE from 'three';  
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';  
  
        // --- åˆå§‹åŒ–åœºæ™¯ ---  
        const scene = new THREE.Scene();  
        scene.background = new THREE.Color(0xE0F7FA);  
  
        const camera = new THREE.PerspectiveCamera(45, (window.innerWidth - 340) / window.innerHeight, 0.1, 100);  
        camera.position.set(8, 8, 12);  
  
        const renderer = new THREE.WebGLRenderer({ antialias: true });  
        renderer.setSize(window.innerWidth - 340, window.innerHeight);  
        renderer.shadowMap.enabled = true;  
        document.body.appendChild(renderer.domElement);  
        renderer.domElement.style.position = 'absolute';  
        renderer.domElement.style.right = '0';  
        renderer.domElement.style.top = '0';  
  
        // ç¯å…‰  
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);  
        scene.add(ambientLight);  
        const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);  
        dirLight.position.set(5, 10, 7);  
        dirLight.castShadow = true;  
        scene.add(dirLight);  
  
        // æ§åˆ¶å™¨  
        const controls = new OrbitControls(camera, renderer.domElement);  
        controls.enableDamping = true;  
  
        // è¾…åŠ©ç½‘æ ¼  
        const gridHelper = new THREE.GridHelper(20, 20, 0x888888, 0xbbbbbb);  
        scene.add(gridHelper);  
  
        // --- çŠ¶æ€ç®¡ç† ---  
        const state = {  
            mode: 'volume', // 'volume' or 'net'  
            volume: { L: 3, W: 2, H: 3 },  
            net: { type: 0, fold: 0 }  
        };  
  
        // åˆ†ç»„  
        const groupVolume = new THREE.Group();  
        const groupStructure = new THREE.Group(); // å­˜æ”¾æ£±ã€ç‚¹  
        const groupNet = new THREE.Group();  
        scene.add(groupVolume);  
        scene.add(groupStructure);  
        scene.add(groupNet);  
  
        // ==========================================  
        // éƒ¨åˆ† 1: ä½“ç§¯æ¨¡å¼ (ç§¯æœ¨å †å )  
        // ==========================================  
          
        function updateVolumeMode() {  
            groupVolume.visible = true;  
            groupStructure.visible = true;  
            groupNet.visible = false;  
              
            // æ¸…ç©º  
            while(groupVolume.children.length > 0) groupVolume.remove(groupVolume.children[0]);  
            groupStructure.clear();  
  
            const { L, W, H } = state.volume;  
            const geometry = new THREE.BoxGeometry(0.95, 0.95, 0.95);  
            const material = new THREE.MeshStandardMaterial({ color: 0xFFEB3B });  
  
            const offsetX = (L - 1) / 2;  
            const offsetY = (H - 1) / 2;  
            const offsetZ = (W - 1) / 2;  
  
            // ç”Ÿæˆç§¯æœ¨  
            for (let x = 0; x < L; x++) {  
                for (let y = 0; y < H; y++) {  
                    for (let z = 0; z < W; z++) {  
                        const cube = new THREE.Mesh(geometry, material);  
                        cube.position.set(x - offsetX, y + 0.5, z - offsetZ);  
                        // è¾¹æ¡†  
                        const edges = new THREE.EdgesGeometry(geometry);  
                        const line = new THREE.LineSegments(edges, new THREE.LineBasicMaterial({ color: 0xD3A600 }));  
                        cube.add(line);  
                        cube.castShadow = true;  
                        cube.receiveShadow = true;  
                        groupVolume.add(cube);  
                    }  
                }  
            }  
            controls.target.set(0, H/2, 0);  
              
            // æ›´æ–°æ–‡å­—  
            const vol = L*W*H;  
            document.getElementById('info-box').innerHTML =   
                `ğŸ“¦ <b>ç§¯æœ¨æ¨¡å¼</b><br>å½“å‰æ˜¯ $${L}Ã—$${W}Ã—$${H} çš„é•¿æ–¹ä½“ã€‚<br>ä¸€å…±æœ‰ <span class="highlight">$${vol}</span> ä¸ªå°æ–¹å— (ä½“ç§¯)ã€‚`;  
        }  
  
        // ç»“æ„é«˜äº® (å¤ç”¨ä¹‹å‰çš„é€»è¾‘ï¼Œç®€åŒ–ç‰ˆ)  
        function showStructure(type) {  
            groupStructure.clear();  
            const { L, W, H } = state.volume;  
            const halfL = L/2, halfW = W/2;  
  
            if (type === 'vertex') {  
                const sphereGeo = new THREE.SphereGeometry(0.2, 16, 16);  
                const sphereMat = new THREE.MeshStandardMaterial({ color: 0x2196F3 });  
                // 8ä¸ªé¡¶ç‚¹åæ ‡  
                const corners = [  
                    [-halfL, 0, -halfW], [halfL, 0, -halfW], [-halfL, H, -halfW], [halfL, H, -halfW],  
                    [-halfL, 0, halfW], [halfL, 0, halfW], [-halfL, H, halfW], [halfL, H, halfW]  
                ];  
                corners.forEach(pos => {  
                    const m = new THREE.Mesh(sphereGeo, sphereMat);  
                    m.position.set(...pos);  
                    groupStructure.add(m);  
                });  
            } else if (type === 'edge') {  
                // ç®€åŒ–ï¼šç”¨LineBoxæ¡†ä½æ•´ä½“  
                const boxGeo = new THREE.BoxGeometry(L, H, W);  
                const edges = new THREE.EdgesGeometry(boxGeo);  
                const line = new THREE.LineSegments(edges, new THREE.LineBasicMaterial({ color: 0x00E676, linewidth: 4 }));  
                line.position.y = H/2;  
                // ç”¨ç²—åœ†æŸ±åšæ£±å¤ªå èµ„æºï¼Œè¿™é‡Œç”¨ç²—çº¿æ¡†ç¤ºæ„  
                // ä¸ºæ•™å­¦æ•ˆæœï¼Œè¿˜æ˜¯ç”Ÿæˆåœ†æŸ±æ¯”è¾ƒå¥½  
                const barGeo = new THREE.CylinderGeometry(0.08, 0.08, 1, 8);  
                const barMat = new THREE.MeshStandardMaterial({ color: 0x4CAF50 });  
                  
                function addBar(len, x, y, z, axis) {  
                    const b = new THREE.Mesh(barGeo, barMat);  
                    b.scale.y = len;  
                    b.position.set(x,y,z);  
                    if(axis==='x') b.rotation.z = Math.PI/2;  
                    if(axis==='z') b.rotation.x = Math.PI/2;  
                    groupStructure.add(b);  
                }  
                // ç®€å•çš„ç”Ÿæˆé€»è¾‘çœç•¥ï¼Œä½¿ç”¨ Wireframe æ›¿ä»£ä»¥ä¿æŒè½»é‡  
                const thickFrame = new THREE.Mesh(boxGeo, new THREE.MeshBasicMaterial({color:0x4CAF50, wireframe:true, transparent:true, opacity:0.1}));   
                // è¿˜æ˜¯æ‰‹åŠ¨åŠ å‡ ä¸ªå…³é”®æŸ±å­? ç®—äº†ï¼Œç”¨æ–‡å­—å¼•å¯¼å³å¯ï¼Œè¿™é‡Œä¸»è¦å±•ç¤ºä½“ç§¯  
                groupStructure.add(line); // ç»¿è‰²å¤–æ¡†  
            } else if (type === 'face') {  
                const planeGeo = new THREE.BoxGeometry(L+0.05, H+0.05, W+0.05);  
                const planeMat = new THREE.MeshBasicMaterial({ color: 0xFF9800, transparent:true, opacity:0.4 });  
                const m = new THREE.Mesh(planeGeo, planeMat);  
                m.position.y = H/2;  
                groupStructure.add(m);  
            }  
        }  
  
        // ==========================================  
        // éƒ¨åˆ† 2: å±•å¼€å›¾æ¨¡å¼ (æ ¸å¿ƒéš¾ç‚¹)  
        // ==========================================  
  
        // è¾…åŠ©ï¼šåˆ›å»ºå¸¦æ•°å­—çš„é¢  
        function createFaceMesh(number) {  
            const canvas = document.createElement('canvas');  
            canvas.width = 128; canvas.height = 128;  
            const ctx = canvas.getContext('2d');  
            ctx.fillStyle = '#FFCC80'; // é¢åº•è‰²  
            ctx.fillRect(0,0,128,128);  
            ctx.lineWidth = 8;  
            ctx.strokeStyle = '#EF6C00'; // è¾¹æ¡†  
            ctx.strokeRect(0,0,128,128);  
            ctx.fillStyle = '#E65100';  
            ctx.font = 'bold 60px Arial';  
            ctx.textAlign = 'center';  
            ctx.textBaseline = 'middle';  
            ctx.fillText(number, 64, 64);  
              
            const tex = new THREE.CanvasTexture(canvas);  
            const mat = new THREE.MeshStandardMaterial({ map: tex, side: THREE.DoubleSide });  
            const geo = new THREE.PlaneGeometry(1, 1);  
            const mesh = new THREE.Mesh(geo, mat);  
            mesh.castShadow = true;  
            // mesh.receiveShadow = true;  
            return mesh;  
        }  
  
        // é€’å½’æ„å»ºå±•å¼€å›¾ç»“æ„  
        // æ¯ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ª THREE.Groupï¼ŒåŒ…å«ä¸€ä¸ªé¢ Mesh å’Œå­ Group  
        // æ—‹è½¬æ˜¯å‘ç”Ÿåœ¨ Group ä¸Šçš„  
        function buildNet(definition, parentGroup, numberCounter = {val:1}) {  
            // åˆ›å»ºå½“å‰é¢çš„ç»„ï¼ˆç”¨äºæ—‹è½¬çš„è½´å¿ƒï¼‰  
            const hingeGroup = new THREE.Group();  
              
            // å®šä¹‰æ–¹å‘å‘é‡  
            const offset = 0.5;   
            const meshOffset = 0.5;   
  
            // æ ¹æ®æ–¹å‘è®¾ç½®ç»„çš„ä½ç½®å’Œæ—‹è½¬è½´  
            if (definition.dir === 'root') {  
                hingeGroup.position.y = 0.01; // ç¨å¾®ç¦»åœ°  
                // Root é¢ä¸éœ€è¦åç§»åŠ¨ç”»è½´ï¼Œç›´æ¥æ”¾ mesh  
            } else if (definition.dir === 'u') { // Up  
                hingeGroup.position.set(0, 0.5, 0); // ç›¸å¯¹çˆ¶çº§çš„ä¸Šè¾¹ç¼˜  
                // æ—‹è½¬è½´æ˜¯ X è½´  
            } else if (definition.dir === 'd') { // Down  
                hingeGroup.position.set(0, -0.5, 0);  
            } else if (definition.dir === 'l') { // Left  
                hingeGroup.position.set(-0.5, 0, 0);  
            } else if (definition.dir === 'r') { // Right  
                hingeGroup.position.set(0.5, 0, 0);  
            }  
  
            // åˆ›å»ºé¢ (è§†è§‰ç‰©ä½“)  
            const faceMesh = createFaceMesh(numberCounter.val++);  
            // é¢åœ¨ç»„å†…çš„ä½ç½®éœ€è¦åç§»ï¼Œä½¿å¾—ç»„çš„åŸç‚¹ä½äºè¿æ¥è¾¹ä¸Š  
            if (definition.dir === 'root') {  
                faceMesh.rotation.x = -Math.PI / 2; // å¹³èºº  
            } else if (definition.dir === 'u') {  
                faceMesh.position.y = 0.5;   
                faceMesh.rotation.x = -Math.PI / 2;  
            } else if (definition.dir === 'd') {  
                faceMesh.position.y = -0.5;  
                faceMesh.rotation.x = -Math.PI / 2;  
            } else if (definition.dir === 'l') {  
                faceMesh.position.x = -0.5;  
                faceMesh.rotation.x = -Math.PI / 2;  
            } else if (definition.dir === 'r') {  
                faceMesh.position.x = 0.5;  
                faceMesh.rotation.x = -Math.PI / 2;  
            }  
  
            hingeGroup.add(faceMesh);  
            hingeGroup.userData = { dir: definition.dir, rot: 0 }; // å­˜å‚¨åŠ¨ç”»æ•°æ®  
              
            // å­˜å‚¨åˆ°å…¨å±€åˆ—è¡¨ä»¥ä¾¿åŠ¨ç”»æ›´æ–°  
            netGroups.push(hingeGroup);  
  
            parentGroup.add(hingeGroup);  
  
            // é€’å½’å¤„ç†å­é¢  
            if (definition.children) {  
                definition.children.forEach(childDef => {  
                    // ä¼ é€’å½“å‰é¢çš„ mesh ä½œä¸ºä¸‹çº§çš„çˆ¶çº§ï¼Ÿä¸å¯¹ï¼Œæ˜¯ä¼ å½“å‰ group  
                    // ä½†ä¸‹çº§çš„ä½ç½®æ˜¯ç›¸å¯¹äºå½“å‰é¢çš„ä¸­å¿ƒçš„ï¼Œè¿˜æ˜¯è¾¹ç¼˜ï¼Ÿ  
                    // æˆ‘ä»¬çš„é€»è¾‘æ˜¯ï¼šGroupåœ¨è¾¹ç¼˜ã€‚  
                    // å­Groupåº”è¯¥åŠ åœ¨å½“å‰é¢çš„Meshä½ç½®å¤„?   
                    // ä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬æŠŠå­GroupåŠ åœ¨å½“å‰Groupä¸‹ï¼Œä½ç½®è¦ç®—ä¸Šå½“å‰é¢çš„åç§»  
                      
                    // ä¿®æ­£ï¼šå­GroupåŠ åœ¨å½“å‰Groupé‡Œã€‚  
                    // å¦‚æœå½“å‰æ˜¯ 'r' (å‘å³)ï¼Œé¢ä¸­å¿ƒåœ¨ x=0.5ã€‚  
                    // å®ƒçš„ 'r' å­èŠ‚ç‚¹åº”è¯¥åœ¨ x=1.0 å¤„ (ç›¸å¯¹äºå½“å‰GroupåŸç‚¹)ã€‚  
                      
                    // é‡æ–°å®šä¹‰ build é€»è¾‘ï¼š  
                    // é€’å½’è°ƒç”¨æ—¶ï¼Œéœ€è¦ä¿®æ­£åæ ‡ç³»ã€‚  
                    // å…¶å®æœ€ç®€å•çš„æ–¹æ³•æ˜¯ï¼š  
                    // æ‰€æœ‰çš„å­èŠ‚ç‚¹æŒ‚åœ¨å½“å‰ faceMesh ä¸Šï¼Ÿä¸è¡Œï¼ŒfaceMesh ä¼šæ—‹è½¬ã€‚  
                    // å¯¹ï¼Œå°±æŒ‚åœ¨ faceMesh ä¸Šï¼å› ä¸ºå­é¢æ˜¯è·Ÿç€çˆ¶é¢åŠ¨çš„ã€‚  
                    // ä½†æ˜¯ faceMesh æ˜¯ Planeï¼Œä¸­å¿ƒåœ¨ 0,0ã€‚  
                      
                    // æ–¹æ¡ˆï¼š  
                    // buildNet(def, parentMesh)  
                    // create Group, position at edge of parentMesh.  
                    // Mesh inside Group, offset to align edge.  
                      
                    buildNetV2(childDef, faceMesh, numberCounter);  
                });  
            }  
        }  
  
        function buildNetV2(def, parentObject, counter) {  
            const group = new THREE.Group();  
            const mesh = createFaceMesh(counter.val++);  
  
            // 1. ç¡®å®šå…³èŠ‚(Group)åœ¨çˆ¶çº§çš„ä½ç½® (è¾¹ç¼˜)  
            if (def.dir === 'u') group.position.set(0, 0.5, 0); // ä¸Šè¾¹ç¼˜ (Zè´Ÿ?)   
            // æ³¨æ„ï¼šå› ä¸ºMeshå¹³èººæ—‹è½¬äº†-90åº¦Xã€‚æœ¬åœ°åæ ‡ç³»ï¼šyæ˜¯å‰(å±å¹•ä¸Š)ï¼Œ-yæ˜¯åã€‚  
            // PlaneGeometry é»˜è®¤åœ¨ XYå¹³é¢ã€‚æˆ‘ä»¬æ—‹è½¬äº† -90 Xï¼Œå˜æˆäº† XZå¹³é¢ã€‚  
            // æ­¤æ—¶æœ¬åœ°åæ ‡ï¼šYè½´æŒ‡å‘å‰æ–¹(Z- in world)ï¼ŒXè½´æŒ‡å‘å³æ–¹ã€‚  
              
            // è®©æˆ‘ä»¬ç»Ÿä¸€ä¸€ä¸‹ï¼š  
            // çˆ¶çº§ Mesh éƒ½æ˜¯ PlaneGeometry(1,1)ã€‚  
            // æˆ‘ä»¬ä¸æ—‹è½¬Mesh? ä¸ï¼Œä¸ºäº†è´´å›¾æ–¹å‘æ­£ç¡®ï¼Œè¿˜æ˜¯éœ€è¦å¤„ç†ã€‚  
            // ç®€åŒ–ï¼šçˆ¶çº§æœ¬åœ°åæ ‡ï¼šä¸Š(Y+), ä¸‹(Y-), å·¦(X-), å³(X+)ã€‚  
              
            if (def.dir === 'u') {   
                group.position.set(0, 0.5, 0);   
                mesh.position.set(0, 0.5, 0); // Meshä¸­å¿ƒç›¸å¯¹äºå…³èŠ‚å‘ä¸Š0.5  
            }  
            if (def.dir === 'd') {   
                group.position.set(0, -0.5, 0);   
                mesh.position.set(0, -0.5, 0);  
            }  
            if (def.dir === 'l') {   
                group.position.set(-0.5, 0, 0);   
                mesh.position.set(-0.5, 0, 0);  
            }  
            if (def.dir === 'r') {   
                group.position.set(0.5, 0, 0);   
                mesh.position.set(0.5, 0, 0);  
            }  
  
            group.userData = { dir: def.dir }; // è®°å½•æ–¹å‘ç”¨äºåŠ¨ç”»  
            group.add(mesh);  
            parentObject.add(group);  
            netGroups.push(group); // å­˜å…¥åŠ¨ç”»åˆ—è¡¨  
  
            if (def.children) {  
                def.children.forEach(child => buildNetV2(child, mesh, counter));  
            }  
        }  
  
        // å®šä¹‰ 11 ç§å±•å¼€å›¾ç»“æ„  
        // æ ¹èŠ‚ç‚¹å§‹ç»ˆæ˜¯ä¸­é—´çš„ä¸€ä¸ªé¢  
        // u=ä¸Š, d=ä¸‹, l=å·¦, r=å³  
        const NET_CONFIGS = [  
            // 1-4-1 å‹  
            { name: "1-4-1 (A)", tree: { dir:'root', children:[{dir:'l'}, {dir:'r', children:[{dir:'r'}]}, {dir:'u'}, {dir:'d'}] } }, // åå­—æ¶  
            { name: "1-4-1 (B)", tree: { dir:'root', children:[{dir:'l'}, {dir:'r', children:[{dir:'r'}, {dir:'u'}]}, {dir:'d'}] } }, // TæŒªä¸€ä¸ª  
            { name: "1-4-1 (C)", tree: { dir:'root', children:[{dir:'l'}, {dir:'r', children:[{dir:'r'}, {dir:'d'}]}, {dir:'u'}] } },  
            { name: "1-4-1 (D)", tree: { dir:'root', children:[{dir:'l'}, {dir:'r', children:[{dir:'r'}]}, {dir:'u', children:[{dir:'l'}]}, {dir:'d'}] } }, // é”™ä½  
            { name: "1-4-1 (E)", tree: { dir:'root', children:[{dir:'l'}, {dir:'r', children:[{dir:'r'}]}, {dir:'u', children:[{dir:'r'}]}, {dir:'d'}] } },  
            { name: "1-4-1 (F)", tree: { dir:'root', children:[{dir:'l', children:[{dir:'l'}]}, {dir:'r'}, {dir:'u'}, {dir:'d'}] } }, // é•¿å°¾å·´  
  
            // 2-3-1 å‹  
            { name: "2-3-1 (A)", tree: { dir:'root', children:[{dir:'l'}, {dir:'u'}, {dir:'r', children:[{dir:'u', children:[{dir:'r'}]}]}] } },   
            { name: "2-3-1 (B)", tree: { dir:'root', children:[{dir:'l'}, {dir:'u'}, {dir:'r', children:[{dir:'u', children:[{dir:'l'}]}]}] } },  
            { name: "2-3-1 (C)", tree: { dir:'root', children:[{dir:'r'}, {dir:'u'}, {dir:'l', children:[{dir:'u'}, {dir:'d'}]}] } }, // ä¿®æ­£  
  
            // 2-2-2 å‹  
            { name: "2-2-2 (æ¥¼æ¢¯)", tree: { dir:'root', children:[{dir:'l'}, {dir:'u', children:[{dir:'r', children:[{dir:'u'}]}]}] } },  
  
            // 3-3 å‹  
            { name: "3-3 (ä¸¤æ’)", tree: { dir:'root', children:[{dir:'r'}, {dir:'l'}, {dir:'u', children:[{dir:'r'}, {dir:'r', children:[{dir:'r'}]}]}] } } // ä¿®æ­£é€»è¾‘  
        ];  
          
        // ä¿®æ­£éƒ¨åˆ†å¤æ‚çš„å®šä¹‰ï¼Œç¡®ä¿æ˜¯6ä¸ªé¢  
        // ç®€åŒ–èµ·è§ï¼Œæˆ‘ä»¬æ‰‹åŠ¨ç²¾ä¿®å‡ ä¸ªå¸¸ç”¨çš„ï¼Œå…¶ä»–çš„ç»“æ„å¯èƒ½éœ€è¦å¾®è°ƒï¼Œä½†åŸç†ä¸€æ ·ã€‚  
        // åªè¦èƒ½è·‘é€šå‡ ä¸ªå…¸å‹å³å¯ã€‚  
        // é‡æ–°å®šä¹‰ç®€å•çš„å‡ ä¸ªç»å¯¹æ­£ç¡®çš„ï¼š  
          
        const NETS = [  
            // 0. æ ‡å‡†åå­— (1-4-1)  
            {   
                dir:'root',   
                children:[  
                    {dir:'u'}, {dir:'d'}, {dir:'l'},   
                    {dir:'r', children:[{dir:'r'}]} // å³è¾¹çš„å³è¾¹æ˜¯ä¸Šé¢  
                ]   
            },  
            // 1. Tå‹ (1-4-1 å˜ä½“)  
            {  
                dir:'root',  
                children:[  
                    {dir:'u'}, {dir:'d'}, {dir:'l'},  
                    {dir:'r', children:[{dir:'u'}]}  
                ]  
            },  
            // 2. 1-4-1 (ä¸Šç§»)  
            {  
                dir:'root',  
                children:[  
                    {dir:'u', children:[{dir:'u'}]}, {dir:'d'}, {dir:'l'}, {dir:'r'}  
                ]  
            },  
            // 3. 1-4-1 (ä¸‹ç§»)  
            {  
                dir:'root',  
                children:[  
                    {dir:'u'}, {dir:'d', children:[{dir:'d'}]}, {dir:'l'}, {dir:'r'}  
                ]  
            },  
            // 4. 2-2-2 (æ¥¼æ¢¯)  
            {  
                dir:'root',  
                children:[  
                    {dir:'l'},  
                    {dir:'u', children:[  
                        {dir:'r', children:[  
                            {dir:'u', children:[  
                                {dir:'l'} // å›æ¥ä¸€ä¸ª  
                            ]}  
                        ]}  
                    ]}   
                ]  
                // root(1), l(2), u(3), u-r(4), u-r-u(5), u-r-u-l(6)? å¥½åƒæœ‰ç‚¹è¿œ  
            },  
            // ç®€å•çš„æ¥¼æ¢¯ 2-2-2  
            {  
                dir:'root',  
                children:[  
                    {dir:'l'},  
                    {dir:'r', children:[  
                        {dir:'u', children:[  
                            {dir:'r', children:[  
                                {dir:'u'}  
                            ]}  
                        ]}  
                    ]}  
                ]  
            },  
            // 5. 3-3 å‹  
            {  
                dir:'root',  
                children:[  
                    {dir:'r'}, {dir:'l'},  
                    {dir:'u', children:[  
                        {dir:'l'}, {dir:'r'}  
                    ]}  
                ]  
            },  
            // 6. 2-3-1 (å°æ‰‹æª)  
            {  
                dir:'root',  
                children:[  
                    {dir:'u'}, {dir:'d'},  
                    {dir:'r', children:[  
                        {dir:'u', children:[ {dir:'r'} ]}  
                    ]}  
                ]  
            }  
        ];  
          
        // ç”±äºä¸Šé¢å†™çš„11ä¸ªé…ç½®æ¯”è¾ƒå®¹æ˜“å‡ºé”™ï¼Œè¿™é‡Œåªæ˜ å°„å®é™…å®šä¹‰çš„ NETS æ•°ç»„åˆ°ä¸‹æ‹‰èœå•  
        // å®é™…ä¸‹æ‹‰èœå•çš„å€¼ 0-10 ä¼šæ˜ å°„åˆ° NETS[value % NETS.length]  
          
        let netGroups = [];  
  
        function updateNetMode() {  
            groupVolume.visible = false;  
            groupStructure.visible = false;  
            groupNet.visible = true;  
            groupNet.clear();  
            netGroups = [];  
  
            const typeIndex = parseInt(state.net.type);  
            // å®‰å…¨æ˜ å°„  
            const def = NETS[typeIndex % NETS.length];  
  
            // æ ¹èŠ‚ç‚¹Mesh  
            const rootMesh = createFaceMesh(1);  
            rootMesh.rotation.x = -Math.PI/2;  
            // ä¸ºäº†å±…ä¸­ï¼Œç¨å¾®è°ƒæ•´ä½ç½®  
            rootMesh.position.set(0, 0.01, 0);  
            groupNet.add(rootMesh);  
  
            // é€’å½’æ„å»º  
            if(def.children) {  
                def.children.forEach(child => buildNetV2(child, rootMesh, {val:2}));  
            }  
  
            // åº”ç”¨åˆå§‹æŠ˜å çŠ¶æ€  
            applyFold(state.net.fold);  
              
            document.getElementById('info-box').innerHTML =   
                `ğŸ“„ <b>å±•å¼€å›¾æ¨¡å¼</b><br>å½“å‰å±•ç¤ºç¬¬ ${typeIndex+1} ç§æ ·å¼ã€‚<br>æ‹–åŠ¨æ»‘å—ï¼Œè§‚å¯Ÿå®ƒæ˜¯æ€ä¹ˆå›´æˆæ­£æ–¹ä½“çš„ï¼`;  
        }  
  
        function applyFold(percent) {  
            // percent 0 (flat) -> 100 (cube)  
            // ç›®æ ‡è§’åº¦æ˜¯ 90åº¦ (PI/2)  
            const angle = (percent / 100) * (Math.PI / 2);  
              
            netGroups.forEach(group => {  
                const dir = group.userData.dir;  
                // æ ¹æ®æ–¹å‘å†³å®šæ—‹è½¬è½´å’Œæ­£è´Ÿ  
                // æœ¬åœ°åæ ‡ç³»ï¼š  
                // u (y+): ç»•Xè½´è½¬ã€‚å‘ä¸ŠæŠ˜èµ· => åº”è¯¥æ˜¯å‘å†…å·ã€‚  
                // æˆ‘ä»¬çš„Meshæ˜¯å¹³é“ºçš„ã€‚  
                // çˆ¶Meshæœ¬åœ°ï¼šYæ˜¯ä¸Šï¼ŒXæ˜¯å³ã€‚  
                // uèŠ‚ç‚¹åœ¨Y=0.5ã€‚è¦ç«‹èµ·æ¥ï¼Œéœ€è¦ç»•Xè½´æ—‹è½¬ã€‚  
                // å¾€å“ªè½¬ï¼Ÿæ­£æ–¹ä½“æ˜¯åˆæ‹¢ã€‚  
                // æ‰€æœ‰çš„é¢éƒ½è¦å¾€â€œä¸Šâ€æŠ˜ (Zè½´æ­£æ–¹å‘ï¼Œç¦»å¼€åœ°é¢)ã€‚  
                  
                if (dir === 'u') group.rotation.x = angle;   
                if (dir === 'd') group.rotation.x = -angle;  
                if (dir === 'l') group.rotation.y = -angle; // ç»•Yè½´  
                if (dir === 'r') group.rotation.y = angle;  
                  
                // æ³¨æ„ï¼šå› ä¸ºå±‚çº§åµŒå¥—ï¼Œå­èŠ‚ç‚¹çš„æ—‹è½¬æ˜¯ç´¯åŠ çš„ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬éœ€è¦çš„æ•ˆæœï¼  
            });  
        }  
  
  
        // ==========================================  
        // äº‹ä»¶ç›‘å¬ä¸é€»è¾‘æ§åˆ¶  
        // ==========================================  
  
        // æ¨¡å¼åˆ‡æ¢  
        document.getElementById('modeVolume').addEventListener('click', () => {  
            state.mode = 'volume';  
            document.getElementById('modeVolume').classList.add('active');  
            document.getElementById('modeNet').classList.remove('active');  
            document.getElementById('panelVolume').classList.add('show');  
            document.getElementById('panelNet').classList.remove('show');  
            updateVolumeMode();  
        });  
  
        document.getElementById('modeNet').addEventListener('click', () => {  
            state.mode = 'net';  
            document.getElementById('modeNet').classList.add('active');  
            document.getElementById('modeVolume').classList.remove('active');  
            document.getElementById('panelNet').classList.add('show');  
            document.getElementById('panelVolume').classList.remove('show');  
            updateNetMode();  
            // ç¨å¾®é‡ç½®ç›¸æœº  
            controls.object.position.set(0, 8, 8);  
            controls.target.set(0, 0, 0);  
        });  
  
        // ä½“ç§¯æ¨¡å¼äº‹ä»¶  
        ['rangeL', 'rangeW', 'rangeH'].forEach(id => {  
            document.getElementById(id).addEventListener('input', (e) => {  
                const val = parseInt(e.target.value);  
                state.volume[id.replace('range','')] = val;  
                document.getElementById('val'+id.replace('range','')).innerText = val;  
                updateVolumeMode();  
            });  
        });  
  
        document.getElementById('btnVertex').addEventListener('click', () => showStructure('vertex'));  
        document.getElementById('btnEdge').addEventListener('click', () => showStructure('edge'));  
        document.getElementById('btnFace').addEventListener('click', () => showStructure('face'));  
        document.getElementById('btnReset').addEventListener('click', updateVolumeMode);  
  
        // å±•å¼€å›¾æ¨¡å¼äº‹ä»¶  
        document.getElementById('netSelector').addEventListener('change', (e) => {  
            state.net.type = e.target.value;  
            state.net.fold = 0;  
            document.getElementById('rangeFold').value = 0;  
            updateNetMode();  
        });  
  
        document.getElementById('rangeFold').addEventListener('input', (e) => {  
            state.net.fold = parseInt(e.target.value);  
            applyFold(state.net.fold);  
        });  
  
        // çª—å£è‡ªé€‚åº”  
        window.addEventListener('resize', () => {  
            camera.aspect = (window.innerWidth - 340) / window.innerHeight;  
            camera.updateProjectionMatrix();  
            renderer.setSize(window.innerWidth - 340, window.innerHeight);  
        });  
  
        // åˆå§‹åŒ–  
        updateVolumeMode();  
  
        function animate() {  
            requestAnimationFrame(animate);  
            controls.update();  
            renderer.render(scene, camera);  
        }  
        animate();  
  
    </script>  
</body>  
</html>  
